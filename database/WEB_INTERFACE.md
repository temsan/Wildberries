# Веб-интерфейс для управления БД Wildberries

## 🚀 Быстрый старт

### 1. Установка зависимостей

```bash
pip install streamlit
```

Или обновите все:
```bash
pip install -r requirements.txt
```

### 2. Запуск интерфейса

```bash
streamlit run database/web_interface.py
```

Откроется браузер с адресом: `http://localhost:8501`

---

## 📋 Возможности

### 📊 Dashboard
- **Основные метрики**: активные товары, баркоды, покрытие ценами
- **Последние операции**: лог синхронизаций
- **Топ товары**: самые дорогие, максимальные скидки
- **Автообновление**: кнопка для обновления данных

### 🔄 Синхронизация
- **Синхронизация артикулов**: Content Cards API → БД
  - Настройка лимита (для тестирования)
  - Прогресс-бар выполнения
  - Статистика результатов
- **Синхронизация цен**: Discounts-Prices API → БД
  - Настройка лимита
  - Автоматическое сохранение в историю
  - Отчет об успешных/проваленных операциях

### 📦 Товары
- **Просмотр товаров**: таблица со всеми активными товарами
- **Фильтрация**: по nmID, артикулу, бренду
- **Детали товара**: полная информация + баркоды
- **Поиск**: интерактивный поиск в реальном времени

### 💰 Цены
- **Просмотр цен**: все товары с ценами
- **Фильтры**:
  - Только с конкурентной ценой
  - Только с промо-акциями
  - Минимальная скидка (слайдер)
- **Статистика**: средняя цена, средняя скидка, покрытие

### 📝 Логи
- **История операций**: последние синхронизации
- **Фильтры**: по статусу (успешно/предупреждение/ошибка)
- **Количество записей**: настраиваемый лимит

### ⚙️ Настройки
- **Очистка данных**:
  - Логи старше 30 дней
  - История цен старше 90 дней
- **Информация о подключении**: URL и ключ Supabase
- **Ссылки на документацию**

---

## 🎨 Интерфейс

### Основные элементы

#### Боковая панель (Sidebar)
- **Статус подключения**: ✅/❌ индикатор
- **Навигация**: переключение между страницами
- **Кнопки действий**: быстрый доступ к функциям

#### Главная область
- **Интерактивные таблицы**: сортировка, фильтрация
- **Метрики**: красивые карточки с цифрами
- **Прогресс-бары**: для длительных операций
- **Уведомления**: успех/предупреждение/ошибка

### Цветовая схема
- 🟢 Зеленый — успешные операции
- 🟡 Желтый — предупреждения
- 🔴 Красный — ошибки
- 🔵 Синий — информация

---

## 📱 Скриншоты функционала

### Dashboard
```
┌─────────────────────────────────────────┐
│ 📊 Dashboard                            │
├─────────────────────────────────────────┤
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐        │
│ │ 250 │ │ 650 │ │ 240 │ │96.0%│        │
│ │Товар│ │Баркд│ │Цены │ │Покр │        │
│ └─────┘ └─────┘ └─────┘ └─────┘        │
├─────────────────────────────────────────┤
│ 📝 Последние операции                   │
│ ┌───────────────────────────────────┐   │
│ │ ✅ fetch_articles  │ 100 │ 0 │    │   │
│ │ ✅ fetch_prices    │  50 │ 0 │    │   │
│ └───────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

### Синхронизация
```
┌─────────────────────────────────────────┐
│ 🔄 Синхронизация данных                 │
├─────────────────────────────────────────┤
│ 📦 Синхронизация артикулов              │
│ Максимум карточек: [100    ] ▶️ Запуск │
│                                         │
│ [████████████████████████] 100%         │
│                                         │
│ ✅ Синхронизация завершена успешно!     │
│ Успешно: 100  Ошибок: 0  Баркодов: 250 │
└─────────────────────────────────────────┘
```

---

## 🛠️ Настройка

### Требования
- Python 3.11+
- Supabase аккаунт с настроенной БД
- `SUPABASE_URL` и `SUPABASE_KEY` в `api_keys.py`

### Конфигурация

По умолчанию интерфейс использует настройки из `api_keys.py`:

```python
# api_keys.py
SUPABASE_URL = "https://your-project.supabase.co"
SUPABASE_KEY = "your-anon-key"
```

### Кастомизация

#### Изменение порта

```bash
streamlit run database/web_interface.py --server.port 8502
```

#### Изменение темы

Создайте `.streamlit/config.toml`:

```toml
[theme]
primaryColor = "#1f77b4"
backgroundColor = "#ffffff"
secondaryBackgroundColor = "#f0f2f6"
textColor = "#262730"
font = "sans serif"
```

#### Отключение меню Streamlit

В `.streamlit/config.toml`:

```toml
[ui]
hideTopBar = false
hideSidebarNav = false
```

---

## 💡 Примеры использования

### Базовый сценарий

1. **Запуск интерфейса**
   ```bash
   streamlit run database/web_interface.py
   ```

2. **Проверка подключения**
   - Откройте sidebar
   - Проверьте статус: ✅ БД подключена

3. **Синхронизация данных**
   - Перейдите в "🔄 Синхронизация"
   - Установите лимит 100 карточек
   - Нажмите "▶️ Запустить"
   - Дождитесь завершения

4. **Просмотр результатов**
   - Перейдите в "📦 Товары"
   - Используйте фильтры для поиска
   - Выберите товар для просмотра деталей

### Продвинутое использование

#### Фильтрация товаров с большими скидками

1. Перейдите в "💰 Цены"
2. Установите слайдер "Минимальная скидка" на 50%
3. Включите "Только с конкурентной ценой"
4. Просмотрите отфильтрованные товары

#### Мониторинг синхронизаций

1. Перейдите в "📝 Логи"
2. Установите лимит 50 записей
3. Фильтруйте по статусу (ошибки/предупреждения)
4. Анализируйте время выполнения

#### Регулярная очистка

1. Перейдите в "⚙️ Настройки"
2. Раз в неделю:
   - Нажмите "🧹 Очистить логи"
   - Нажмите "🧹 Очистить историю"

---

## 🐛 Troubleshooting

### Ошибка: "БД не подключена"

**Причина:** Неверные credentials или отсутствие в `api_keys.py`

**Решение:**
1. Проверьте `SUPABASE_URL` и `SUPABASE_KEY` в `api_keys.py`
2. Убедитесь, что БД создана (выполнен `schema.sql`)
3. Проверьте интернет-соединение

### Ошибка: "streamlit: command not found"

**Решение:**
```bash
pip install streamlit
```

### Медленная загрузка данных

**Причина:** Большое количество записей в БД

**Решение:**
1. Используйте фильтры для уменьшения выборки
2. Добавьте индексы в Supabase (если еще не добавлены)
3. Очистите старые данные через настройки

### Интерфейс не обновляется

**Решение:**
1. Нажмите кнопку "🔄 Обновить" в Dashboard
2. Или перезагрузите страницу в браузере (Ctrl+R)

---

## 🔒 Безопасность

### Публичный доступ

⚠️ **НЕ разворачивайте интерфейс публично без аутентификации!**

Для продакшена:
1. Добавьте аутентификацию через Streamlit Cloud
2. Используйте VPN или корпоративную сеть
3. Настройте firewall правила

### Secrets в Streamlit

Вместо `api_keys.py` используйте Streamlit secrets:

```toml
# .streamlit/secrets.toml
[supabase]
url = "https://your-project.supabase.co"
key = "your-anon-key"
```

В коде:
```python
import streamlit as st

SUPABASE_URL = st.secrets["supabase"]["url"]
SUPABASE_KEY = st.secrets["supabase"]["key"]
```

---

## 🚢 Развертывание

### Локально

```bash
streamlit run database/web_interface.py
```

### Streamlit Cloud (бесплатно)

1. Залогиньтесь на [share.streamlit.io](https://share.streamlit.io)
2. Подключите GitHub репозиторий
3. Укажите путь: `database/web_interface.py`
4. Добавьте secrets через UI
5. Deploy!

### Docker

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 8501

CMD ["streamlit", "run", "database/web_interface.py", "--server.port=8501", "--server.address=0.0.0.0"]
```

Запуск:
```bash
docker build -t wb-interface .
docker run -p 8501:8501 wb-interface
```

---

## 📊 Производительность

### Оптимизация

1. **Кэширование данных** (уже реализовано через `st.session_state`)
2. **Пагинация** (при необходимости добавить для больших таблиц)
3. **Ленивая загрузка** (загружать данные только при открытии страницы)

### Рекомендации

- Для БД > 10,000 товаров: добавьте пагинацию
- Для долгих операций: используйте прогресс-бары (уже есть)
- Для частого доступа: настройте кэширование в Supabase

---

## 🔗 Интеграция с другими инструментами

### Google Sheets

Добавьте кнопку экспорта в интерфейс:

```python
if st.button("📊 Экспорт в Google Sheets"):
    data = db.get_active_articles_for_export()
    # Используйте существующий google_sheets_writer
    # ...
    st.success("✅ Экспорт завершен!")
```

### Telegram бот

Добавьте уведомления о завершении синхронизации:

```python
def send_telegram_notification(message):
    # Реализация отправки в Telegram
    pass

# После синхронизации
send_telegram_notification(f"✅ Синхронизация завершена: {stats}")
```

---

## 📚 Дополнительные ресурсы

- [Streamlit Documentation](https://docs.streamlit.io/)
- [Streamlit Gallery](https://streamlit.io/gallery) - примеры приложений
- [Supabase Python Client](https://github.com/supabase-community/supabase-py)

---

**Версия:** 1.0  
**Дата:** 2025-10-03  
**Автор:** AI Assistant

